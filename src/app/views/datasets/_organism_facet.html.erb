<div class="facet-group" 
     data-controller="hierarchical-facet"
     id="facet-organisms">
  <!-- Facet header -->
  <%= button_tag type: "button",
    class: "w-full flex items-center justify-between text-left font-semibold text-gray-700 mb-2 group",
    data: { action: "click->hierarchical-facet#toggle" } do %>
    <div class="flex items-center">
      <span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
      Organism
      <!-- Selected count badge -->
    </div>
    <!-- Expand/collapse arrow -->
  <% end %>
  <div class="space-y-2 overflow-hidden transition-all duration-200"
       data-hierarchical-facet-target="content">
    <!-- Filter input -->
    <div class="space-y-1.5" data-hierarchical-facet-target="items">
      <% @organism_facet_rows.each do |row| %>
        <div class="relative flex items-start py-0.5 px-1 rounded-md hover:bg-gray-50" 
             data-hierarchical-facet-target="item" 
             data-value="<%= row[:name].downcase %>"
             data-level="<%= row[:level] %>">
          <div class="min-w-0 flex items-center" style="padding-left: <%= row[:level] * 16 %>px">
            <!-- Checkbox -->
            <% checkbox_id = "organisms_#{row[:name].parameterize}" %>
            <%= form.check_box "organisms[]", 
                { 
                  id: checkbox_id,
                  checked: params[:organisms]&.include?(row[:name]),
                  class: "h-4 w-4 rounded border-gray-300 focus:ring-brand-light text-brand-light cursor-pointer",
                  data: {
                    action: "change->hierarchical-facet#handleSelection",
                    level: row[:level]
                  }
                },
                row[:name],
                nil %>
            <!-- Label -->
            <%= form.label checkbox_id, class: "ml-2 block text-sm text-gray-600" do %>
              <span class="font-medium"><%= row[:name].capitalize %></span>
              <span class="ml-1 text-xs text-gray-400">(<%= row[:count] %>)</span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
 